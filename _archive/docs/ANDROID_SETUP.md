# 📱 Android「AIスーパー・クリップボード」設定マニュアル

このマニュアルは、あなたのスマホに以下の能力を授けるための手順書です。

1. **先読み:** コピーした瞬間、裏でAIが「要約・翻訳・返信案」を作って待機する
2. **空気読み:** Slackならフランクに、メールなら丁寧に、アプリに合わせてキャラ変する
3. **スイッチ:** 使いたい時だけONにできる（バッテリーに優しい）

---

## 🛠 準備するもの

Google Playストアから以下の2つの無料アプリをインストールしてください。

1. **HTTP Shortcuts** (青いイナズマのアイコン)
   - 役割：サーバーと通信する「ボタン」を作ります
2. **MacroDroid** (赤や青のブロックのアイコン)
   - 役割：コピー操作を検知して、自動で通信させる「自動化」担当

---

## ステップ 1: サーバーの場所（URL）をメモする

Google Colabを実行した最後に表示された、以下のURLを使います。
これが「AIの司令室」への住所です。

> **URLの例:** `https://xxxx-xxxx-xxxx.ngrok-free.app`
>
> ※ Colabを起動し直すたびに変わるので、メモ帳などに控えてください

---

## ステップ 2: 「結果を受け取るボタン」を作る (HTTP Shortcuts)

コピーした後、「AIが作った結果」を表示するためのメニューボタンを作ります。

### 2-1. 新しいショートカットを作成

1. **HTTP Shortcuts** アプリを開きます
2. 右下の **「＋」** を押し、**「新しいショートカット」** をタップ
3. 以下の通りに入力します：
   - **名前:** `AI受信`（好きな名前でOK）
   - **説明:** 結果リストを取得
   - **メソッド:** `GET`（ここをタップして変更）
   - **URL:** `[あなたのURL]/prefetch/{clipboard}`

> ※ `{clipboard}` は、「変数を挿入」ボタンから選ぶか、手入力してください

### 2-2. 応答の設定

1. **「応答 (Response)」** タブをタップ
2. **実行後の動作:** `ダイアログで応答を表示` を選択
3. **応答の処理:** `JSON` を選択

### 2-3. 保存

1. 右上の **「✔（保存）」** をタップ
2. ホーム画面にこのショートカットを配置しておきます

---

## ステップ 3: 「先読み機能」を作る (MacroDroid)

コピーした瞬間に、裏でAIに指示を飛ばす設定です。

### 3-1. ON/OFFスイッチ用の変数を作る

1. **MacroDroid** を開きます
2. 下のメニューの **「変数」** をタップ → 右下の「＋」
   - 名前: `AI_Switch`
   - 型: `真偽値 (Boolean)`
   - OKを押す（値はFalseでOK）

### 3-2. スイッチ切り替えマクロを作る

1. 下のメニューの **「マクロ」** → 「マクロを追加」
2. **マクロ名:** `AIスイッチ`
3. **トリガー (赤):**
   - 「ユーザー入力」→「クイック設定タイル」→「第1タイル」→「ボタンを押す」
4. **アクション (青):**

   ```
   1. 変数を設定: AI_Switch → 「値を反転 (Toggle)」
   
   2. If: AI_Switch == True
      → クイック設定タイル: 第1タイル → 「有効 (ON)」
      
   3. Else:
      → クイック設定タイル: 第1タイル → 「無効 (OFF)」
      
   4. End If
   ```

5. 保存して戻ります

### 3-3. クイック設定パネルにタイルを追加

**スマホ本体の設定:**
画面上からスワイプして出るパネル（クイック設定）の編集ボタンを押し、
**「MacroDroidタイル1」** を追加してください。

これでスイッチ完成です！ 🎉

### 3-4. 先読み実行マクロを作る

1. **「マクロを追加」** をタップ
2. **マクロ名:** `AI先読み実行`
3. **トリガー (赤):**
   - 「機器のイベント」→「クリップボード更新時」
4. **アクション (青):**
   - 「接続」→「HTTPリクエスト」
   - **メソッド:** `POST`
   - **URL:** `[あなたのURL]/prefetch`
   - **ヘッダー:** `Content-Type: application/json`
   - **コンテンツ (Body):** 以下をコピーして貼り付け

     ```json
     {
       "text": "[clipboard]",
       "current_app": "[fg_app_package]"
     }
     ```

   - ⚠️ **重要:** 「応答を待つ」「結果を変数に保存」のチェックは**外す**（投げっぱなし）

5. **制約 (緑):** ※これが無いと常に動いてしまいます！
   - 「Macrodroid固有」→「マクロ実行中/変数」→ 変数 `AI_Switch` が True

6. 保存します

---

## 🏁 これで完成です！使ってみましょう

### 1. スイッチ・オン 🟢

スマホのクイック設定パネルを開き、**「MacroDroidタイル」** をタップしてONにします
（アイコンが光ります）

### 2. コピーしてみる 📋

例えば **Slack** を開いて、誰かのメッセージをコピーします：
> 「明日の会議、資料お願いね」

（この瞬間、裏でAIが「Slack用のフランクな返信」と「タスクの要約」を作り始めます）

### 3. 受け取る ✨

メモ帳やSlackの入力欄を開き、ホーム画面に置いた **「AI受信」** アイコンをタップします

**結果：**
画面に **「了解です！資料準備しますね🫡」** などのAIが生成したテキストが表示されます。
タップすればコピーされるので、そのまま貼り付けられます。

---

## ⚠️ 注意点（Colabを使う場合）

Google Colabは、しばらく放置すると接続が切れて **URLが変わります**。
動かなくなったら、以下のメンテナンスが必要です：

1. PCでColabを開き、再生ボタンを押して再起動
2. 新しいURLが表示される
3. スマホの **HTTP Shortcuts** と **MacroDroid** のURL設定を書き換える

（※これを自動化する方法もありますが、まずは「動く感動」を味わってみてください！）

---

## 🔧 トラブルシューティング

### クリップボード監視が動かない

- Macrodroidにバッテリー最適化の除外設定が必要
- 設定 → アプリ → Macrodroid → バッテリー → 制限なし

### APIに接続できない

- ngrokのURLが変わっていないか確認
- Colab/サーバーが起動しているか確認

### 結果が空で返ってくる

- プリセット（mail_fix, summarize, english）が登録されているか確認
- `/presets` でプリセット一覧を確認

---

## 📚 関連ドキュメント

- [COLAB_SETUP.md](./COLAB_SETUP.md) - サーバー起動方法
- [CHANGELOG.md](./CHANGELOG.md) - バージョン履歴
